var model = require('../models/cake.js');

module.exports = {
    index: function(req, res) {
        model.Cake.find({}, function (err, cakes) {
            if (err) {
                res.json(err);
            }
            else {
                res.json({message: "Show all cakes! cakes.js", cakes});
            }
        })
    },
    showCake: function(req, res) {
        model.Cake.findOne({ _id: req.params.id }, function (err, cake) {
            if (err) {
                res.json(err);
            }
            else {
                res.json({message: "Show cake!", cake});
            }
        })
    },
    newCake: function(req, res) {
        var cake = new model.Cake({ name: req.body.name, image: req.body.image});
        cake.save(function (err) {
            if (err) {
                res.json(err);
            }
            else {
                res.json({message: "Added cake!", cake});
            }
        })
    },
    rateCake: function(req, res){
        var rating = new model.Rating({ rating: req.body.rating, comment: req.body.comment});
        rating.save(function (err, rating) {
            if (err) {
                res.json(err);
            }
            else {
                model.Cake.updateOne({ _id: req.params.id }, { $push: { rating:rating }}, function(err, cake){
                    if(err) {
                        res.json(err);
                    }
                    else {
                        res.json({message:"Cake updated!", cake});
                    }
                })
            }
        })
    }                            
}